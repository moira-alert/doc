

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Self State Monitor &mdash; Moira 2.5.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Development" href="../development/index.html" />
    <link rel="prev" title="Maintenance" href="maintenance.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Moira
          

          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simple.html">Simple Threshold Trigger</a></li>
<li class="toctree-l2"><a class="reference internal" href="subscriptions.html">Setting Up Your Subscriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="efficient.html">Efficient Triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="schedule.html">Schedules</a></li>
<li class="toctree-l2"><a class="reference internal" href="trigger_page.html">Current State and Event History</a></li>
<li class="toctree-l2"><a class="reference internal" href="throttling.html">Throttling</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodata.html">Dealing with NODATA</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html">Advanced Mode Trigger</a></li>
<li class="toctree-l2"><a class="reference internal" href="hidden_pages.html">Hidden Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintenance.html">Maintenance</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Self State Monitor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-self-state-monitor">Why Self State Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-self-state-monitor-helps">When Self State Monitor Helps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-self-state-monitor-works">How Self State Monitor Works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#turn-moira-notifier-on-and-off">Turn Moira Notifier On and Off</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contacts.html">Contact Moira Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gsoc.html">Google Summer of Code</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Moira</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Self State Monitor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user_guide/selfstate.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="self-state-monitor">
<h1>Self State Monitor<a class="headerlink" href="#self-state-monitor" title="Permalink to this headline">¶</a></h1>
<p>Self State Monitor is a built-in mechanism designed to protect
end user from false <code class="docutils literal notranslate"><span class="pre">NODATA</span></code> notifications and notify administrator
about issues in Moira and/or Graphite systems.</p>
<div class="section" id="why-self-state-monitor">
<h2>Why Self State Monitor<a class="headerlink" href="#why-self-state-monitor" title="Permalink to this headline">¶</a></h2>
<p>A situation is possible when Graphite Relay, Redis DB or Moira-Filter
service breaks down. This leads to the fact that Moira doesn’t receive
any metrics from Graphite. In this case, Moira has no metrics on which
it could check state of the triggers. According to the Moira logic,
it should switch triggers to <code class="docutils literal notranslate"><span class="pre">NODATA</span></code> state and send alert messages to users.</p>
<p>To handle this situation properly, we recommend turning on the Self
State Monitor. In this case, Moira will <strong>prevent itself from sending
alert messages to end users but notify administrators of the existing
problem</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When Self State Monitor detects a problem, it disables any notifications to end users
and does not turn it back on without manual intervention.</p>
<p>Please, read this manual before using Self State Monitor in production.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For a better understanding, look at the architecture of the <a class="reference internal" href="../overview.html#microservices-architecture"><span class="std std-ref">Moira microservices</span></a>.</p>
</div>
</div>
<div class="section" id="when-self-state-monitor-helps">
<span id="when-monitor-helps"></span><h2>When Self State Monitor Helps<a class="headerlink" href="#when-self-state-monitor-helps" title="Permalink to this headline">¶</a></h2>
<p>Self state monitor checks these situations:</p>
<ol class="arabic simple">
<li><p>If there is no connection between Moira and Redis for longer
than <code class="docutils literal notranslate"><span class="pre">redis_disconect_delay</span></code>.</p></li>
<li><p>If Moira-Filter receive no metrics for longer than
<code class="docutils literal notranslate"><span class="pre">last_metric_received_delay</span></code>.</p></li>
<li><p>If Moira-Checker checks no triggers for longer than <code class="docutils literal notranslate"><span class="pre">last_check_delay</span></code>.</p></li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>All the above configuration parametres can be found in the <a class="reference internal" href="../installation/configuration.html#notifier-configuration"><span class="std std-ref">Moira-Notifier section</span></a>
on configuration page.</p>
</div>
</div>
<div class="section" id="how-self-state-monitor-works">
<h2>How Self State Monitor Works<a class="headerlink" href="#how-self-state-monitor-works" title="Permalink to this headline">¶</a></h2>
<p>When you turn Self State Monitor on, it works this way:</p>
<ul>
<li><p>Self State Monitor checks <a class="reference internal" href="#when-monitor-helps"><span class="std std-ref">Moira state</span></a>
every 10 seconds.</p></li>
<li><p>Something breaks down. It can be Graphite-Relay, connection
to Redis DB or crashed Moira-Filter docker container.</p></li>
<li><p>Self State send alarm message to administrator with issue discription.</p>
<p><em>Here is an example of message</em>:</p>
<blockquote>
<div><a class=""
               data-lightbox="group-e0aecd93-e978-4d50-8ecb-e616d4d8f1a3"
               href="../_images/helth-check-email1.png"
               title=""
               data-title=""
               ><img src="../_images/helth-check-email1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt="email alarm message"/>
                </a></div></blockquote>
</li>
<li><p>Self State Monitor turns Moira-Notifier service off,
switching it in <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When Moira-Notifier switches to <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> state, it mutes all messages to end users and only alerts administrators about Moira health issues.
You need to fix existing problems and then manually switch Moira-Notifier back to <code class="docutils literal notranslate"><span class="pre">OK</span></code> using <a class="reference internal" href="#notifier-state-api"><span class="std std-ref">API</span></a>.</p>
</div>
<p><em>When Moira-Notifier not in</em> <code class="docutils literal notranslate"><span class="pre">OK</span></code> <em>state, Moira will show you an error in Web UI</em>:</p>
<blockquote>
<div><a class=""
               data-lightbox="group-93891a03-fcd4-4ad7-8ffd-7ddaf54b0d29"
               href="../_images/helth-check-webui1.png"
               title=""
               data-title=""
               ><img src="../_images/helth-check-webui1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt="WEB UI error notification"/>
                </a></div></blockquote>
</li>
</ul>
<hr class="docutils" />
</div>
<div class="section" id="turn-moira-notifier-on-and-off">
<span id="notifier-state-api"></span><h2>Turn Moira Notifier On and Off<a class="headerlink" href="#turn-moira-notifier-on-and-off" title="Permalink to this headline">¶</a></h2>
<p>You can reveal current Moira-Notifier state or change it
on a hidden <code class="docutils literal notranslate"><span class="pre">/notifications</span></code> page.</p>
<a class=""
               data-lightbox="group-7f625f7e-7e72-4c60-b62c-a6ca1b9c4cda"
               href="../_images/notifier-toggle1.png"
               title=""
               data-title=""
               ><img src="../_images/notifier-toggle1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt="Notifier toggle"/>
                </a><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please, note this toggle changes Moira-Notifier state, not user notifications preferences.</p>
<p>When you disable notifications with this toggle, Moira-Notifier stops sending messages to all users.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../development/index.html" class="btn btn-neutral float-right" title="Development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="maintenance.html" class="btn btn-neutral float-left" title="Maintenance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, SKB Kontur.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>