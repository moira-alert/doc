

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Advanced Mode Trigger &mdash; Moira 2.5.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hidden Pages" href="hidden_pages.html" />
    <link rel="prev" title="Dealing with NODATA" href="nodata.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Moira
          

          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simple.html">Simple Threshold Trigger</a></li>
<li class="toctree-l2"><a class="reference internal" href="subscriptions.html">Setting Up Your Subscriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="efficient.html">Efficient Triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="schedule.html">Schedules</a></li>
<li class="toctree-l2"><a class="reference internal" href="trigger_page.html">Current State and Event History</a></li>
<li class="toctree-l2"><a class="reference internal" href="throttling.html">Throttling</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodata.html">Dealing with NODATA</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced Mode Trigger</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#templates">Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-source">Data source</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hidden_pages.html">Hidden Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintenance.html">Maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="selfstate.html">Self State Monitor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contacts.html">Contact Moira Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gsoc.html">Google Summer of Code</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Moira</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Advanced Mode Trigger</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user_guide/advanced.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="advanced-mode-trigger">
<h1>Advanced Mode Trigger<a class="headerlink" href="#advanced-mode-trigger" title="Permalink to this headline">¶</a></h1>
<p>Sometimes a simple trigger (<a class="reference internal" href="simple.html"><span class="doc">Simple Threshold Trigger</span></a>)
doesn’t provide enough flexibility for your task.</p>
<p>For example, you may want to receive a notification when 5% of user
requests take up more than a second to process, but only if there are
more than 100 requests per minute. Usually, you will have two separate
metrics for this:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Nginx.requests.process_time.p95</span></code> - 95th percentile
of request processing time in milliseconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Nginx.requests.count</span></code> - request count per minute</p></li>
</ol>
<p>Maybe you can construct a monstrous Graphite expression to reflect
this combination, but Moira’s Advanced Mode is better:</p>
<a class=""
               data-lightbox="group-eb37b8e8-5591-4f25-8230-575fd8bdcb9d"
               href="../_images/advanced1.png"
               title=""
               data-title=""
               ><img src="../_images/advanced1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt="advanced trigger"/>
                </a><p>You can use any <a class="reference external" href="https://github.com/Knetic/govaluate/blob/master/MANUAL.md">govaluate</a> expression with predefined constants here:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">t1</span></code>, <code class="docutils literal notranslate"><span class="pre">t2</span></code>, … are values from your targets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OK</span></code>, <code class="docutils literal notranslate"><span class="pre">WARN</span></code>, <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>, <code class="docutils literal notranslate"><span class="pre">NODATA</span></code> are states that must be
the result of evaluation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PREV_STATE</span></code> is equal to previously set state, and allows you
to prevent frequent state changes</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only T1 target can resolve into multiple metrics in Advanced Mode. T2, T3, … must resolve to single metrics.
Moira will calculate expression separately for every metric in T1.</p>
</div>
<p>Any incorrect expressions or bad syntax will result in EXCEPTION trigger state.</p>
<div class="section" id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h2>
<p>The template is supported by Moira, the template implements data-driven templates for generating textual output.
Information about how to program the templates themselves, see the <a class="reference external" href="https://golang.org/pkg/html/template/">documentation.</a></p>
<p>Data you can use:</p>
<div class="line-block">
<div class="line">Trigger { Name }</div>
<div class="line">Events  [ ] {</div>
<div class="line-block">
<div class="line">Metric</div>
<div class="line">MetricElements [ ]string</div>
<div class="line">Timestamp</div>
<div class="line">Value</div>
<div class="line">State</div>
</div>
<div class="line">}</div>
</div>
<p>Example:</p>
<p><code class="docutils literal notranslate"><span class="pre">https://grafana.yourhost.com/some-dashboard{{</span> <span class="pre">range</span> <span class="pre">$i,</span> <span class="pre">$v</span> <span class="pre">:=</span> <span class="pre">.Events</span> <span class="pre">}}{{</span> <span class="pre">if</span> <span class="pre">ne</span> <span class="pre">$i</span> <span class="pre">0</span> <span class="pre">}}&amp;{{</span> <span class="pre">else</span> <span class="pre">}}?{{</span> <span class="pre">end</span> <span class="pre">}}var-host={{</span> <span class="pre">$v.Metric</span> <span class="pre">}}{{</span> <span class="pre">end</span> <span class="pre">}}</span></code></p>
</div>
<div class="section" id="data-source">
<h2>Data source<a class="headerlink" href="#data-source" title="Permalink to this headline">¶</a></h2>
<p>If <a class="reference internal" href="../installation/configuration.html#remote-triggers-checker"><span class="std std-ref">Remote Triggers Checker</span></a> is enabled, you can
choose between following Data Sources:</p>
<ul>
<li><p><a class="reference external" href="https://redis.io/">Redis</a> — Moira database. By default Redis stores data for only several hours.
It covers most of user cases when you need real-time alerting.</p></li>
<li><p><a class="reference external" href="https://github.com/go-graphite/carbonapi">Graphite</a> — remote Graphite-like HTTP API. It should be used only when you
need to get metrics for a large period.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please, use this Data Source with caution. It may cause extra load on Graphite HTTP API.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Please, keep in mind that functions in Remote and Local triggers can work differently.
To avoid this, make sure you use Carbonapi with the same revision as in Moira. Latest Carbonapi listed in <span class="xref std std-doc">../changelog</span>.</p>
</div>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="hidden_pages.html" class="btn btn-neutral float-right" title="Hidden Pages" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="nodata.html" class="btn btn-neutral float-left" title="Dealing with NODATA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, SKB Kontur.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>